<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_Side_Nav___Swarm" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-toc-path="[%=System.LinkedTitle%]|[%=System.LinkedTitle%]" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false">
    <!-- saved from url=(0016)http://localhost -->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" /><title>Example email module</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/foundation.6.2.3.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Styles.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Tablet.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../../Skins/Fluid/Stylesheets/Mobile.css" rel="stylesheet" type="text/css" data-mc-generated="True" />
        <link href="../Resources/Stylesheets/perforce.css" rel="stylesheet" type="text/css" />
        <style>/*&lt;meta /&gt;*/

.button.print-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.remove-highlight-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.previous-topic-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../Resources/Scripts/PIE.htc');
}

</style>
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" />
        <script src="../../Resources/Scripts/jquery.min.js" type="text/javascript">
        </script>
        <script src="../../Resources/Scripts/purify.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/require.config.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/foundation.6.2.3_custom.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js" type="text/javascript" defer="defer">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js" type="text/javascript" defer="defer">
        </script>
        <script>/* <![CDATA[ */		/*The following script overrides topic title in browser tab*/
			document.title = "Helix Swarm Guide (2022.1)";
		/* ]]> */</script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" role="navigation" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-accordion vertical menu off-canvas-list" data-accordion-menu="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" role="banner" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="only screen and (max-width: 980px)" data-mc-ignore="true"><a class="skip-to-content fluid-skip showOnFocus" href="#">Skip To Main Content</a>
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <div class="central-account-wrapper">
                                        <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                            <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                                <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="menu-icon" aria-label="Show Navigation Panel" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="home-swarm.html" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" role="navigation" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="central-account-wrapper">
                                    <div class="central-dropdown"><a class="central-account-drop"><span class="central-account-image"></span><span class="central-account-text">Account</span></a>
                                        <div class="central-dropdown-content"><a class="MCCentralLink central-dropdown-content-settings">Settings</a>
                                            <hr class="central-separator" /><a class="MCCentralLink central-dropdown-content-logout">Logout</a>
                                        </div>
                                    </div>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" aria-label="Search Field" placeholder="Search" />
                                                <div class="search-filter-wrapper"><span class="invisible-label" id="search-filters-label">Filter: </span>
                                                    <div class="search-filter" aria-haspopup="true" aria-controls="sf-content" aria-expanded="false" aria-label="Search Filter" title="All Files" role="button" tabindex="0">
                                                    </div>
                                                    <div class="search-filter-content" id="sf-content">
                                                        <ul>
                                                            <li>
                                                                <button class="mc-dropdown-item" aria-labelledby="search-filters-label filterSelectorLabel-00001"><span id="filterSelectorLabel-00001">All Files</span>
                                                                </button>
                                                            </li>
                                                        </ul>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search" role="button" tabindex="0"><span class="invisible-label">Submit Search</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <div class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <nav class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </nav>
                            <div class="body-container">
                                <div data-mc-content-body="True">
                                    <div id="skin-heading-swarm"><span class="mc-variable Perforce.Manual_Title variable">Helix Swarm Guide</span> (<span class="mc-variable Perforce.VersionNumber variable">2022.1</span>)</div>
                                    <script src="../Resources/google-analytics/gtag.js">
                                    </script>
                                    <script type="text/javascript">/*<![CDATA[*/
			$(document).ready(function(){
			$("#skin-heading-swarm").appendTo("div.logo-wrapper"); 
			});
		/*]]>*/</script>
                                    <div class="buttons popup-container clearfix topicToolbarProxy _Skins_Topic_Toolbar mc-component nocontent" style="mc-topic-toolbar-items: ExpandAll Print RemoveHighlight NextTopic PreviousTopic Forward Back;">
                                        <div class="button-group-container-left">
                                            <button class="button needs-pie print-button" title="Print this topic">
                                                <div>
                                                    <div role="img" class="button-icon-wrapper" aria-label="Print">
                                                        <div class="button-icon"> </div>
                                                    </div>
                                                </div>
                                            </button>
                                            <button class="button needs-pie remove-highlight-button" title="Remove Highlights">
                                                <div>
                                                    <div role="img" class="button-icon-wrapper">
                                                        <div class="button-icon"> </div>
                                                    </div>
                                                </div>
                                            </button>
                                            <button class="button needs-pie previous-topic-button" title="Go to previous heading" disabled="true">
                                                <div>
                                                    <div role="img" class="button-icon-wrapper" aria-label="Navigate previous">
                                                        <div class="button-icon"> </div>
                                                    </div>
                                                </div>
                                            </button>
                                            <button class="button needs-pie next-topic-button" title="Go to next heading" disabled="true">
                                                <div>
                                                    <div role="img" class="button-icon-wrapper" aria-label="Navigate next">
                                                        <div class="button-icon"> </div>
                                                    </div>
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="nocontent">
                                        <div class="MCBreadcrumbsBox_0 breadcrumbs" role="navigation" aria-label="Breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix"> </span>
                                        </div>
                                    </div>
                                    <div class="sidenav-content">
                                        <div role="main" id="mc-main-content">
                                            <h1 data-mc-autonum=""><a name="Example_email_module" data-mc-generated-bookmark="TOC"></a><span class="autonumber"><span></span></span>Example email module</h1>
                                            <p>The following example module demonstrates how to customize the email template <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> uses when sending notifications for comments. </p>
                                            <div class="note admonition" data-mc-autonum="Note "><span class="autonumber"><span class="admonition">Note </span></span>
                                                <p><span class="mc-variable Perforce.Swarm_short variable">Swarm</span> supports the Laminas component versions in the <span class="code_clearBackground">LICENSE.txt</span> file, features and functions in the Laminas documentation that were introduced in later versions of Laminas will not work with <span class="mc-variable Perforce.Swarm_short variable">Swarm</span>. The <span class="code_clearBackground">LICENSE.txt</span> file is in the <span class="code_clearBackground">readme</span> folder of your <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> installation.</p>
                                            </div>
                                            <div class="tip admonition" data-mc-autonum="Tip "><span class="autonumber"><span class="admonition">Tip </span></span>
                                                <p>You must test your custom modules on a test system before transferring them to your production system.  This avoids any negative impact on the operation of your production system.  If you have more than one custom module, the modules should all be tested at the same time on the same test system as this ensures that the modules operate correctly with each other and with <span class="mc-variable Perforce.Swarm_long variable">Helix Swarm</span>. </p>
                                            </div>
                                            <div class="tip admonition" data-mc-autonum="Tip "><span class="autonumber"><span class="admonition">Tip </span></span>
                                                <p>If you add or edit a module, <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> will not use that change until the  config cache has been reloaded, this forces <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> to  use the module change. You must be an <i>admin</i> or <i>super</i> user to reload the <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> config cache. Navigate to the <b xmlns="http://docbook.org/ns/docbook">User id</b> dropdown menu, select <b xmlns="http://docbook.org/ns/docbook">System Information</b>, click the <b xmlns="http://docbook.org/ns/docbook">Cache Info</b> tab, and click the <a href="admin.system_information.html#admin_system_information_cache_info_reload_config" class="MCXref xref">Reload Configuration button</a>. </p>
                                            </div>
                                            <p style="font-weight: bold;">Basic steps needed to create the Email Example module are: </p>
                                            <ul>
                                                <li><a href="#extending.example_email.module" class="MCXref xref">Create the Module.php file</a>
                                                </li>
                                                <li><a href="#extending.example_email.module_config" class="MCXref xref">Create the module.config.php file</a>
                                                </li>
                                                <li><a href="#extending.example_email.listener" class="MCXref xref">Create the Listener.php file</a>
                                                </li>
                                                <li><a href="#extending.example_email.comment_html_phtml" class="MCXref xref">Create the comment-html.phtml file</a>
                                                </li>
                                                <li><a href="#extending.example_email.comment_text_phtml" class="MCXref xref">Create the comment-text.phtml file</a>
                                                </li>
                                                <li><a href="#extending.example_email.enable_emailexample" class="MCXref xref">Enable the EmailExample module for Swarm in custom.modules.config.php</a>
                                                </li>
                                            </ul>
                                            <p style="font-weight: bold;">Further reading:</p>
                                            <p><a href="#extending.example_email.extend_example" class="MCXref xref">Extending the EmailExample module to other email templates</a>
                                            </p>
                                            <h2 data-mc-autonum=""><a name="File_locations_..538" data-mc-generated-bookmark="TOC"></a><span class="autonumber"><span></span></span><a name="extending.example_email.file_locations"></a>File locations</h2>
                                            <p>For reference, the EmailExample module uses the following filenames and locations: </p><pre class="programlisting">config/
      custom.modules.config.php
module/
      EmailExample/
                  config/
                         module.config.php
                  src/
                     Listener/
                              Listener.php		
                  view/
                       mail/
                           commit-html.phtml
                           commit-text.phtml
                           comment-html.phtml
                           comment-text.phtml
                           review-html.phtml
                           review-text.phtml
                  Module.php
</pre>
                                            <h2 data-mc-autonum=""><a name="Create_the_Module.php_file_..539" data-mc-generated-bookmark="TOC"></a><span class="autonumber"><span></span></span><a name="extending.example_email.module"></a>Create the Module.php file</h2>
                                            <p><span class="code_clearBackground">Module.php</span> will: </p>
                                            <ul>
                                                <li>Declare the module namespace, this must match the  directory name of the module</li>
                                                <li>Provide the <span class="code_clearBackground">getConfig()</span> function</li>
                                                <div class="tip admonition" data-mc-autonum="Tip "><span class="autonumber"><span class="admonition">Tip </span></span>
                                                    <p><b>Optional:</b> You can also implement the <span class="code_clearBackground">onBootstrap (Event $event)</span> function if you want to do some early setup when the module is loaded: </p><pre class="programlisting" lang="php" xml:space="preserve">
public function onBootstrap(Event $event)
{
}</pre>
                                                    <p><span class="code_clearBackground">Event</span> is a Laminas class and is added after namespace:</p><pre class="programlisting" lang="php" xml:space="preserve">
namespace EmailExample
use Laminas\EventManager\Event
</pre>
                                                </div>
                                            </ul>
                                            <p style="font-weight: bold;">Create the Module.php file: </p>
                                            <ol>
                                                <li value="1">Create a directory called <span class="code_clearBackground">EmailExample</span> in the module directory.</li>
                                                <li value="2">
                                                    <p>Create the file <span class="code_clearBackground">Module.php</span> in <span class="code_clearBackground">module/EmailExample</span>. </p>
                                                </li>
                                                <li value="3">Edit <span class="code_clearBackground">Module.php</span> to contain:</li><pre class="programlisting" lang="php" xml:space="preserve">
&lt;?php
/**  
 * Perforce Swarm
 *
 * @copyright   2019 Perforce Software. All rights reserved.
 * @license     Please see LICENSE.txt in top-level folder of this distribution.
 * @version     &lt;release&gt;/&lt;patch&gt;
*/

namespace EmailExample;

class Module
{
    public function getConfig()
    {
        return include __DIR__ . '/config/module.config.php';
    }
}</pre>
                                                <li value="4">Now <a href="#extending.example_email.module_config" class="MCXref xref">Create the module.config.php file</a>.</li>
                                            </ol>
                                            <h2 data-mc-autonum=""><a name="Create_the_module.config.php_file_..540" data-mc-generated-bookmark="TOC"></a><span class="autonumber"><span></span></span><a name="extending.example_email.module_config"></a>Create the module.config.php file</h2>
                                            <li>The <span class="code_clearBackground">module.config.php</span> file will:</li>
                                            <ul style="color: #000000;">
                                                <li style="color: #000000;">Configure your module including event listeners</li>
                                                <li>Declare an event priority of <span class="code_clearBackground">-199</span> for the event listener because email delivery events are processed with a priority of <span class="code_clearBackground">-200</span> and the example event needs to run just before the email delivery event.</li>
                                            </ul>
                                            <div class="tip admonition" data-mc-autonum="Tip "><span class="autonumber"><span class="admonition">Tip </span></span>
                                                <p><span class="code_clearBackground">Listener::class</span> example details: </p>
                                                <ul>
                                                    <li><span class="code_clearBackground">Events\Listener\ListenerFactory::ALL =&gt; [</span>
                                                    </li>
                                                    <p>We are listening to <span class="code_clearBackground">ALL</span> here for convenience because we are listening for mail events but this means it will trigger on every event. Usually is better to just listen for the events you are interested in. For example, if you are interested in commits and shelves you would listen on <span class="code_clearBackground">COMMIT</span> and <span class="code_clearBackground">SHELVE</span> events. </p>
                                                    <li><span class="code_clearBackground">Events\Listener\ListenerFactory::PRIORITY =&gt; -199,</span>
                                                    </li>
                                                    <p>Declares an event priority of <span class="code_clearBackground">-199</span> for the event listener because email delivery events are processed with a priority of <span class="code_clearBackground">-200</span> and the example event needs to run just before the email delivery event. </p>
                                                    <li><span class="code_clearBackground">Events\Listener\ListenerFactory::CALLBACK =&gt; 'handleEmail',</span>
                                                    </li>
                                                    <p>Declares the function name within the listener class that is called.</p>
                                                    <li><span class="code_clearBackground">Events\Listener\ListenerFactory::MANAGER_CONTEXT =&gt; 'queue'</span>
                                                    </li>
                                                    <p>Triggers your custom listener  when <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> processes the <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> event queue.</p>
                                                </ul>
                                            </div>
                                            <p style="font-weight: bold;">Create the module.config.php file: </p>
                                            <ol>
                                                <li value="1">Create a directory called <span class="code_clearBackground">config</span> in the <span class="code_clearBackground">EmailExample</span> directory.</li>
                                                <li value="2">Create a file called <span class="code_clearBackground">module.config.php</span> in <span class="code_clearBackground">config</span>. </li>
                                                <li value="3">Edit <span class="code_clearBackground">module.config.php</span> to contain:</li><pre class="programlisting" lang="php" xml:space="preserve">&lt;?php
/**
 * Perforce Swarm
 *
 * @copyright   2019 Perforce Software. All rights reserved.
 * @license     Please see LICENSE.txt in top-level folder of this distribution.
 * @version     &lt;release&gt;/&lt;patch&gt;
*/

$listeners = [EmailExample\Listener\Listener::class];
return [
    'listeners' =&gt; $listeners,
    'service_manager' =&gt;[
        'factories' =&gt; array_fill_keys(
            $listeners,
            Events\Listener\ListenerFactory::class
        )
    ],
    Events\Listener\ListenerFactory::EVENT_LISTENER_CONFIG =&gt; [ 
        Events\Listener\ListenerFactory::ALL =&gt; [
            EmailExample\Listener\Listener::class =&gt; [
                [
                    Events\Listener\ListenerFactory::PRIORITY =&gt; -199,
                    Events\Listener\ListenerFactory::CALLBACK =&gt; 'handleEmail',
                    Events\Listener\ListenerFactory::MANAGER_CONTEXT =&gt; 'queue'
                ]
            ]
        ]
    ]
];		</pre>
                                                <li value="4">Now <a href="#extending.example_email.listener" class="MCXref xref">Create the Listener.php file</a>.  </li>
                                            </ol>
                                            <h2 data-mc-autonum=""><a name="Create_the_Listener.php_file" data-mc-generated-bookmark="TOC"></a><span class="autonumber"><span></span></span><a name="extending.example_email.listener"></a>Create the Listener.php file</h2>
                                            <p>The <span class="code_clearBackground">Listener.php</span> file will: </p>
                                            <ul>
                                                <li>Contains the implementation of your event listener</li>
                                                <li>Allow logging</li>
                                            </ul>
                                            <p style="font-weight: bold;">Create the Listener.php file: </p>
                                            <ol>
                                                <li value="1">Create a directory called <span class="code_clearBackground">src</span> in the <span class="code_clearBackground">EmailExample</span> directory.</li>
                                                <li value="2">Create a directory called <span class="code_clearBackground">Listener</span> in the <span class="code_clearBackground">src</span> directory.</li>
                                                <li value="3">Create a file called <span class="code_clearBackground">Listener.php</span> in <span class="code_clearBackground">Listener</span>. </li>
                                                <li value="4">Edit <span class="code_clearBackground">Listener.php</span> to contain:</li>
                                                <p><pre class="programlisting" lang="php" xml:space="preserve">
&lt;?php
/**
 * Perforce Swarm
 *
 * @copyright   2019 Perforce Software. All rights reserved.
 * @license     Please see LICENSE.txt in top-level folder of this distribution.
 * @version     &lt;release&gt;/&lt;patch&gt;
*/

namespace EmailExample\Listener;

use Events\Listener\AbstractEventListener;
use Laminas\EventManager\Event;

class Listener extends AbstractEventListener
{
    /**
     * Automatically uses any custom email templates found under this
     * module's view/mail folder (e.g. Example/view/mail/commit-html.phtml).
     *
     * Valid templates include:
     *
     *  commit-html.phtml (HTML version of commit notification)
     *  commit-text.phtml (text version of commit notification)
     *  comment-html.phtml (HTML version of comment notification)
     *  comment-text.phtml (text version of comment notification)
     *  review-html.phtml (HTML version of review notification)
     *  review-text.phtml (text version of review notification)
     *
     * Note: you need to provide custom templates for both HTML and text;
     * if you do not provide both, it is possible that the search for
     * customized templates only finds the non-customized versions, making
     * it appear that this module is not working.
     */

    /**
     * Handle the Email and set the new templates.
     *
     * @param Event $event
     */
    public function handleEmail(Event $event)
    {
        $logger = $this-&gt;services-&gt;get('logger');
        $logger-&gt;info("EmailExample: handleEmail");
        $mail = $event-&gt;getParam('mail');
        if (!$mail || !isset($mail['htmlTemplate'], $mail['textTemplate'])) {
            return;
        }

        $html = __DIR__ . '/view/mail/' . basename($mail['htmlTemplate']);
        $text = __DIR__ . '/view/mail/' . basename($mail['textTemplate']);

        if (file_exists($html)) {
            $mail['htmlTemplate'] = $html;
        }
        if (file_exists($text)) {
            $mail['textTemplate'] = $text;
        }

        $event-&gt;setParam('mail', $mail);
        $logger-&gt;info("EmailExample: handleEmail end.");
    }
}</pre>
                                                </p>
                                                <li value="5">Now <a href="#extending.example_email.comment_html_phtml" class="MCXref xref">Create the comment-html.phtml file</a>. </li>
                                            </ol>
                                            <h2 data-mc-autonum=""><a name="Create_the_comment-html.phtml_file" data-mc-generated-bookmark="TOC"></a><span class="autonumber"><span></span></span><a name="extending.example_email.comment_html_phtml"></a>Create the comment-html.phtml file</h2>
                                            <p>The <span class="code_clearBackground">comment-html.phtml</span> file  is a view script that provides the content for the HTML portion of the comment notification email. </p>
                                            <div class="tip admonition" data-mc-autonum="Tip "><span class="autonumber"><span class="admonition">Tip </span></span>
                                                <p>It is considered best practice to use inline CSS for styling emails.</p>
                                            </div>
                                            <p style="font-weight: bold;">Create the comment-html.phtml file: </p>
                                            <ol>
                                                <li value="1">Create a directory called <span class="code_clearBackground">view</span> in the <span class="code_clearBackground">module/Example</span> directory.</li>
                                                <li value="2">Create a directory called <span class="code_clearBackground">mail</span> in the <span class="code_clearBackground">module/Example/view</span> directory.</li>
                                                <li value="3">Create the <span class="code_clearBackground">comment-html.phtml</span> file in <span class="code_clearBackground">module/Example/view/mail</span>. </li>
                                                <li value="4">Edit <span class="code_clearBackground">comment-html.phtml</span> to contain:</li><pre class="programlisting" lang="php" xml:space="preserve">&lt;?php<br />    $user       = $activity-&gt;get('user');<br />    $userLink   = $user<br />                ? $this-&gt;qualifiedUrl('user', array('user' =&gt; $user))<br />                : null;<br />    $targetLink = $activity-&gt;getUrl($this-&gt;plugin('qualifiedUrl'));<br />?&gt;<br />&lt;html&gt;<br />  &lt;body style="font-family: sans-serif; background-color: #eee; padding: 1em;"&gt;<br />    &lt;div style="background-color: #fff; border: 1px solid #ccc; padding: 1em;"&gt;<br />      &lt;div style="font-size: 115%;"&gt;<br />        &lt;?php if ($user): ?&gt;<br />          &lt;a style="text-decoration: none;" href="&lt;?php echo $userLink ?&gt;"&gt;<br />            &lt;?php echo $this-&gt;escapeHtml($user) ?&gt;<br />          &lt;/a&gt;<br />        &lt;?php endif; ?&gt;<br />        &lt;?php echo $this-&gt;escapeHtml($activity-&gt;get('action')) ?&gt;<br />        &lt;a style="text-decoration: none;" href="&lt;?php echo $targetLink ?&gt;"&gt;<br />          &lt;?php echo $this-&gt;escapeHtml($activity-&gt;get('target'))?&gt;<br />        &lt;/a&gt;<br />      &lt;/div&gt;<br />      &lt;br/&gt;<br />      &lt;?php<br />          // if the comment has file context, show it.<br />          $comment = $event-&gt;getParam('comment');<br />          $context = $comment<br />                   ? $comment-&gt;getFileContext()<br />                   : array('content' =&gt; null, 'line' =&gt; null);<br />          if (is_array($context['content']) &amp;&amp; $context['line']) {<br />             $line = $context['line'] - count($context['content']) + 1;<br />             echo '&lt;div style="font-family: monospace; white-space: nowrap;'<br />                . ' padding: .5em 1em; overflow-x: auto; color: #444;'<br />                . ' border: 1px solid #ddd; background-color: #f7f7f7;"&gt;';<br />             foreach ((array) $context['content'] as $i =&gt; $content) {<br />                echo '&lt;div&gt;&lt;span style="color: #999;"&gt;'<br />                    . str_pad($line + $i,<br />                              strlen($context['line']),<br />                              "0",<br />                              STR_PAD_LEFT<br />                      )<br />                    . '.&lt;/span&gt;&amp;nbsp;'<br />                    . $this-&gt;preformat($content)<br />                           -&gt;setLinkify(false)<br />                           -&gt;setEmojify(false)<br />                           -&gt;setWordWrap(900)<br />                    . "&lt;/div&gt;\n";<br />            }<br />            echo '&lt;/div&gt;&lt;br/&gt;';<br />         }<br />      ?&gt;<br />      &lt;div style="padding-bottom: .5em;"&gt;<br />      &lt;?php<br />          echo $this-&gt;preformat($activity-&gt;get('description'))<br />                  -&gt;setBaseUrl($this-&gt;qualifiedUrl())<br />                  -&gt;setEmojify(false)<br />                  -&gt;setWordWrap(900)<br />      ?&gt;<br />    &lt;/div&gt;<br />  &lt;/div&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</pre>
                                                <li value="5">Now <a href="#extending.example_email.comment_text_phtml" class="MCXref xref">Create the comment-text.phtml file</a>. </li>
                                            </ol>
                                            <h2 data-mc-autonum=""><a name="Create_the_comment-text.phtml_file" data-mc-generated-bookmark="TOC"></a><span class="autonumber"><span></span></span><a name="extending.example_email.comment_text_phtml"></a>Create the comment-text.phtml file</h2>
                                            <p>The <span class="code_clearBackground">comment-text.phtml</span> is a view script that provides the content for the text-only portion of the comment notification email.</p>
                                            <p style="font-weight: bold;">Create the comment-text.phtml file: </p>
                                            <ol>
                                                <li value="1">Create the file <span class="code_clearBackground">comment-text.phtml</span> in the <span class="code_clearBackground">module/Example/view/mail</span> directory. </li>
                                                <li value="2">Edit <span class="code_clearBackground">comment-text.phtml</span> to contain:<pre class="programlisting" lang="php" xml:space="preserve">&lt;?php<br />    echo trim($activity-&gt;get('user')<br />        . ' commented on '<br />        . $activity-&gt;get('target'));
<br />    // if the comment has file context, show it.<br />    $comment = $event-&gt;getParam('comment');<br />    $context = $comment<br />             ? $comment-&gt;getFileContext()<br />             : array('content' =&gt; null);<br />    if (is_array($context['content'])) {<br />        echo "\n\n&gt; " . $this-&gt;wordWrap(<br />            implode("\n&gt; ", $context['content']), 900<br />        );<br />    }

    echo "\n\n" . trim($this-&gt;wordWrap($activity-&gt;get('description'), 900));
    echo "\n\n" . $activity-&gt;getUrl($this-&gt;plugin('qualifiedUrl'));
?&gt;</pre></li>
                                                <li value="3">Now <a href="#extending.example_email.enable_emailexample" class="MCXref xref">Enable the EmailExample module for Swarm in custom.modules.config.php</a>. </li>
                                            </ol>
                                            <h2 data-mc-autonum=""><a name="Enable_the_EmailExample_module_for_Swarm_in_custom.modules.config.php" data-mc-generated-bookmark="TOC"></a><span class="autonumber"><span></span></span><a name="extending.example_email.enable_emailexample"></a>Enable the EmailExample module for <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> in custom.modules.config.php</h2>
                                            <p><span class="mc-variable Perforce.Swarm_short variable">Swarm</span> uses the <span class="code_clearBackground">custom.modules.config.php</span> file to auto-load classes and to check which custom modules it should run. This gives you control over which modules <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> loads and prevents modules from being loaded by mistake.</p>
                                            <p style="font-weight: bold;">Create  the custom.modules.config.php file: </p>
                                            <ol>
                                                <li value="1">Create the <span class="code_clearBackground">config</span> directory at the same level as the <span class="code_clearBackground">module</span> directory if it does not exist. </li>
                                                <li value="2">Create the <span class="code_clearBackground">custom.modules.config.php</span> file in the <span class="code_clearBackground">config</span> directory if it does not exist. </li>
                                                <li value="3">Edit the <span class="code_clearBackground">custom.modules.config.php</span> file so that it contains the auto-loader and the <span class="code_clearBackground">EmailExample</span> module details:</li>
                                                <div class="tip admonition" data-mc-autonum="Tip "><span class="autonumber"><span class="admonition">Tip </span></span>
                                                    <p>If you already have one or more custom modules enabled for <span class="mc-variable Perforce.Swarm_short variable">Swarm</span>, the auto-loader and the existing module details will already be in the file. </p>
                                                    <p>Just add <span class="code_clearBackground">EmailExample</span> to the <span class="code_clearBackground">namespaces</span> and <span class="code_clearBackground">return</span> arrays of the <span class="code_clearBackground">custom.modules.config.php</span> file. </p>
                                                </div>
                                                <p><pre class="programlisting" lang="php" xml:space="preserve">&lt;?php
\Laminas\Loader\AutoloaderFactory::factory(
    array(
        'Laminas\Loader\StandardAutoloader' =&gt; array(
            'namespaces' =&gt; array(
                'EmailExample'      =&gt; BASE_PATH . '/module/EmailExample/src',
            )
        )
    )
);
return [
    'EmailExample'
];
</pre>
                                                </p>
                                                <li value="4">The <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> config cache must be reloaded so that <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> can see your new module. As an <i>admin</i> or <i>super</i> user, navigate to the <b xmlns="http://docbook.org/ns/docbook">User id</b> dropdown menu, select <b xmlns="http://docbook.org/ns/docbook">System Information</b>, click the <b xmlns="http://docbook.org/ns/docbook">Cache Info</b> tab, and click the <a href="admin.system_information.html#admin_system_information_cache_info_reload_config" class="MCXref xref">Reload Configuration button</a>. </li>
                                                <p>The Email Example module is now enabled for <span class="mc-variable Perforce.Swarm_short variable">Swarm</span>. <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> will use the new custom email template whenever a comment notification is sent out. </p>
                                                <li value="5">Check that the module works correctly before moving it to your production server. </li>
                                            </ol>
                                            <h2 data-mc-autonum=""><a name="Extending_the_EmailExample_module_to_other_email_templates" data-mc-generated-bookmark="TOC"></a><span class="autonumber"><span></span></span><a name="extending.example_email.extend_example"></a>Extending the EmailExample module to other email templates</h2>
                                            <p>If you need to customize any other types of <span class="mc-variable Perforce.Swarm_short variable">Swarm</span> notification email messages, locate the view scripts (both HTML and text) and copy them into <span class="code_clearBackground">module/Example/view/mail</span>, maintaining the existing filenames, then modify the new files as desired.</p>
                                            <div class="note admonition" data-mc-autonum="Note "><span class="autonumber"><span class="admonition">Note </span></span>
                                                <p>If you do not copy both the HTML and text templates, it is possible for the search for customized templates to only find non-customized versions, making it appear that your module is not working.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="invisible"><a href="../Shared/SearchTips-swarm.html" class="MCXref xref">Your search for  returned  result(s).</a>
                                    </p>
                                    <p class="invisible"><span class="invisible"><link href="../Resources/Fonts/OpenSans-Regular.ttf" /><link href="../Resources/Fonts/OpenSans-Bold.ttf" /><link href="../Resources/Fonts/OpenSans-BoldItalic.ttf" /><link href="../Resources/Fonts/OpenSans-Italic.ttf" /><link href="../Resources/Fonts/cour.ttf" /><link href="../Resources/Fonts/courbd.ttf" /><link href="../Resources/Fonts/courbi.ttf" /><link href="../Resources/Fonts/couri.ttf" /></span>
                                    </p>
                                    <div class="home-footer">
                                        <div><a href="https://www.perforce.com/support/documentation" target="_blank"><img src="../Resources/FooterImages/Docs_28x28.png" title="View additional product documentation" alt="Additional product documentation" class="FooterIcon" style="width: 28;height: 28;" /></a>
                                        </div>
                                        <div><a href="https://www.perforce.com/support/training" target="_blank"><img src="../Resources/FooterImages/training_28x28.png" title="Visit the Perforce Training portal" alt="Perforce training portal" class="FooterIcon" style="width: 28;height: 28;" /></a>
                                        </div>
                                        <div><a href="https://www.perforce.com/support/video-tutorials" target="_blank"><img src="../Resources/FooterImages/video-tutorials_28x28.png" title="Visit the Perforce video library" alt="Perforce video library" class="FooterIcon" style="width: 28;height: 28;" /></a>
                                        </div>
                                        <div><a href="https://community.perforce.com/s/" target="_blank"><img src="../Resources/FooterImages/KB_28x28.png" title="Visit the Perforce knowledge base" alt=" Perforce knowledge base" class="FooterIcon" style="width: 28;height: 28;" /></a>
                                        </div>
                                        <div><a href="https://www.perforce.com/support" target="_blank"><img src="../Resources/FooterImages/Support_28x28.png" title="Go to Perforce customer support" alt="Perforce customer support" class="FooterIcon" style="width: 28;height: 28;" /></a>
                                        </div>
                                        <div><a href="mailto:manual@perforce.com?subject=Documentation feedback" target="_blank"><img src="../Resources/FooterImages/feedback_28x28.png" title="How can we improve this topic?" alt="Email us at: manual@perforce.com" class="FooterIcon" style="width: 28;height: 28;" /></a>
                                        </div>
                                        <div><a href="http://www.perforce.com/" target="_blank"><img src="../Resources/FooterImages/Perforce-LOGO-WHITE_150x17.png" style="width: 150;height: 17;" alt="" /></a>
                                        </div>
                                    </div>
                                    <script type="text/javascript" src="../Resources/google-code-prettify/prettify.js">
                                    </script>
                                    <script type="text/javascript">/* <![CDATA[ */
    // hookup prettify
    $("pre.programlisting").each(function () {
      var $this = $(this),
          lang = $this.attr("lang");
      if (lang) {
        $this.addClass("lang-" + lang);
       // if (lang !== "bash") 
		// {
        $this.addClass("prettyprint");
        //}
      }
    });
    window.prettyPrint();
    /* ]]> */</script>
                                </div>
                            </div>
                        </div>
                    </div><a data-close="true"></a>
                </div>
            </div>
        </div>
    </body>
</html>