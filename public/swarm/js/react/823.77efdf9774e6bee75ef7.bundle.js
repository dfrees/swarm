"use strict";(self.webpackChunkswarm=self.webpackChunkswarm||[]).push([[823],{74823:function(e,t,n){n.r(t),n.d(t,{default:function(){return se}});var r=n(67294),a=n(45697),i=n.n(a),o=n(56847),l=n(82302),c=n(83750),s=n(57394),u=n(17196),d=n(99613),m=n(32427),f=n(28216),p=n(28889),g=n(26793),v=n(97473),h=n(71744),w=n(61384),y=n(59542),E=n(282),b=n(85639),Z=n(38396),S=n(41120),R=n(22318),A=n(51182),N=n(59031),C=n(74489);function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return z(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var k=(0,S.Z)((function(e){return{reviewDateButton:{textTransform:"none",minWidth:e.spacing(17),marginLeft:e.spacing(-1),paddingTop:0,paddingBottom:0,"& span":{justifyContent:"space-between"}},reviewDateMenu:{"& ul":{minWidth:e.spacing(16)}}}})),O=function(){var e=["created","updated"],t=(0,g.$)("review").t,n=(0,r.useMemo)((function(){return{created:t("created"),updated:t("lastUpdated")}}),[]),a=k(),i=(0,f.I0)(),o=T(r.useState(null),2),l=o[0],c=o[1],s=(0,r.useContext)(C.ZP).config.reviews.filters.date_field,u=T((0,r.useState)((0,f.v9)((function(e){return e.reviewList[e.reviewList.activeQuery].dateField}))||s||e[0]),2),d=u[0],m=u[1],v=function(t,n){if(e[n]&&e[n]!==d){var r=e[n];m(r),i((0,N.hX)(r))}c(null)};return r.createElement(p.Z,{className:"reviewDate"},r.createElement(E.Z,{className:a.reviewDateButton,onClick:function(e){c(e.currentTarget)},disableRipple:!0,endIcon:r.createElement(A.Z,{direction:l?"up":"down"})},n[d]),r.createElement(Z.Z,{id:"review-date-menu",open:!!l,anchorEl:l,anchorOrigin:{vertical:"bottom",horizontal:"left"},getContentAnchorEl:null,onClose:v,className:a.reviewDateMenu},e.map((function(e,t){return r.createElement(b.Z,{key:"review-date-menu-".concat(e),onClick:function(e){return v(0,t)}},r.createElement(R.Z,{variant:"body2",className:"smaller"},n[e]))}))))},x=(0,m.Z)({fieldHeading:{textTransform:"capitalize"}}),M=function(e){return function(e){var t=(0,g.$)("review").t,n=x(),a=(0,r.useContext)(C.ZP).config.reviews.filters,i="center";switch(e){case"author":return r.createElement(p.Z,{className:n.fieldHeading});case"created":case"updated":if(a.result_sorting)return r.createElement(O,{name:e,className:n.fieldHeading});i="left";break;case"description":case"lastActivity":case"votes":case"comments":case"dashboardRole":i="left"}return r.createElement(p.Z,{className:n.fieldHeading,align:i},t(e))}(e.name)},j=M;M.propTypes={name:i().string.isRequired};var H=n(31292),L=n(98497),B=n(13350),I=n(21889),q=n(86675),P=n(44091),D=(0,r.lazy)((function(){return(0,q.Z)((function(){return n.e(838).then(n.bind(n,73838))}))})),U=(0,r.lazy)((function(){return(0,q.Z)((function(){return n.e(832).then(n.bind(n,87832))}))})),V=(0,r.lazy)((function(){return(0,q.Z)((function(){return Promise.resolve().then(n.bind(n,55364))}))})),W=(0,r.lazy)((function(){return(0,q.Z)((function(){return n.e(950).then(n.bind(n,32256))}))})),F=(0,r.lazy)((function(){return(0,q.Z)((function(){return n.e(429).then(n.bind(n,52429))}))})),$=(0,r.lazy)((function(){return(0,q.Z)((function(){return n.e(95).then(n.bind(n,72095))}))})),K=(0,r.lazy)((function(){return(0,q.Z)((function(){return Promise.resolve().then(n.bind(n,84045))}))})),Y=(0,r.lazy)((function(){return(0,q.Z)((function(){return n.e(414).then(n.bind(n,14414))}))})),_=(0,r.lazy)((function(){return(0,q.Z)((function(){return n.e(137).then(n.bind(n,42137))}))})),Q=(0,r.lazy)((function(){return(0,q.Z)((function(){return Promise.resolve().then(n.bind(n,48757))}))})),X=(0,S.Z)((function(e){return{author:{"& span":{display:"none"},"& .userAvatar":{height:e.spacing(4),width:e.spacing(4),fontSize:e.spacing(2)},"& .userAvatarWrapper":{margin:0}}}})),G=function(e){var t=e.review,n=e.fieldName;return r.createElement(r.Suspense,{fallback:null},function(e,t){var n=X(),a=(0,f.v9)(P.BR);switch(t){case"id":return r.createElement(V,{emphasis:"highlighted",id:e.id});case"author":return r.createElement(D,{className:n.author},r.createElement(Q,{show:{avatar:!0,fullName:!1,id:!1},user:e.author}));case"description":return r.createElement(r.Fragment,null,r.createElement(H.Z,{text:e.description},r.createElement(B.Z,{href:"".concat(a,"reviews/").concat(e.id)},r.createElement(L.Z,{description:e.description}))),r.createElement(I.Z,{id:e.id,user:e.author,isReviewPending:e.pending,created:e.created,projects:e.projects,variant:"list"}));case"state":return r.createElement(D,{align:"center"},r.createElement(W,{state:e.state,commitCount:e.commits.length,labelled:!1}));case"comments":return r.createElement(U,{commentCount:e.metadata&&e.metadata.comments?e.metadata.comments[0]:0});case"votes":return r.createElement($,{upVotes:e.metadata&&e.metadata.upVotes,downVotes:e.metadata&&e.metadata.downVotes});case"created":return r.createElement(D,{align:"left"},r.createElement(K,{epochSeconds:e.created||0}));case"updated":case"lastActivity":return r.createElement(D,null,r.createElement(K,{epochSeconds:e.updated||0}));case"complexity":return r.createElement(Y,{complexity:e.complexity});case"testStatus":return r.createElement(F,{status:e.testStatus});case"dashboardRole":return r.createElement(_,{roles:e.roles||[]});default:return r.createElement(D,{component:"span"},e[t])}}(t,n))},J=G;G.propTypes={fieldName:i().string.isRequired,review:i().objectOf(i().oneOfType([i().any])).isRequired};var ee=n(50997),te=function(e){var t=e.value,n=e.size;return r.createElement(p.Z,{className:"emoticon",display:"inline-block"},(0,ee.emojify)(t,{style:{height:n,width:n}}))};te.propTypes={value:i().string.isRequired,size:i().number},te.defaultProps={size:16};var ne=te,re=n(64460);function ae(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,l=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){l=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(l)throw a}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ie(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var oe=Date.now()/1e3-15768e4,le=(0,m.Z)((function(e){return{root:{paddingBottom:e.spacing(4),"& th, & td":{width:"6%",paddingTop:e.spacing(1.25),paddingRight:e.spacing(3),paddingBottom:e.spacing(1.25),paddingLeft:e.spacing(2),borderBottomColor:e.palette.colors.grey[80],borderBottom:"1px solid","&.review-description-column":{width:"55%",maxWidth:e.spacing(12)},"&.review-created-column, &.review-updated-column, &.review-lastActivity-column":{width:"12%",minWidth:e.spacing(22)},"&.review-votes-column":{width:"9%"},"&.review-author-column":{width:e.spacing(4),minWidth:e.spacing(4),paddingLeft:e.spacing(1),paddingRight:0},"&.review-dashboardRole-column":{width:"9%"}}},reviewListTHead:{backgroundColor:e.palette.colors.grey[30]},loading:{paddingBottom:e.spacing(.5),paddingTop:e.spacing(.5)},reviewListFooter:{"& .messageText":{color:e.palette.colors.grey[300]}}}})),ce=function(e){var t=(0,g.$)("review").t,n=e.reviews,a=e.loading,i=e.messages,m=e.fields,E=e.footerMessageKeys,b=(0,f.v9)(re.pe),Z=b.totalCount,S=b.lastSeen,R=b.afterUpdated,A=b.query,C=b.dateField,T=function(e){var t;return null!==(t=E[e])&&void 0!==t?t:e},z=ae((0,r.useState)("loading"),2),k=z[0],O=z[1],x=(0,r.useRef)(0),M=le(),H=(0,f.I0)(),L=ae((0,r.useState)(null),2),B=L[0],I=L[1];(0,r.useEffect)((function(){i&&i.length&&I(i.filter((function(e){return"AbortError"!==e.name})))}),[i]),(0,r.useEffect)((function(){var e="loading";n?e=n.length===Z?n.length?"noMoreReviews":"noReviews":window.innerHeight+Math.round(window.pageYOffset)<document.body.offsetHeight?"empty":"loading":B&&(e="empty"),O(e)}),[a,B,n,Z]);var q=function(){if("updated"===C){if(!a&&R&&(n||[]).length<Z)if(R<oe){var e=(n||[]).length;H((0,N.RV)({query:A,count:{totalCount:e,reviewCount:e,lastSeen:S,afterUpdated:null}}))}else H((0,N.MZ)({id:S,updated:R}))}else{var t=(n||[]).length;null!==Z&&t!==Z&&(x.current===t?H((0,N.RV)({query:A,count:{totalCount:t,reviewCount:t,lastSeen:S,afterUpdated:null}})):x.current<t&&H((0,N.MZ)({id:S,updated:null}))),x.current=t}};return(0,r.useEffect)((function(){window.innerHeight+Math.round(window.pageYOffset)<document.body.offsetHeight||q()}),[n]),(0,r.useEffect)((function(){var e=function(){window.innerHeight+Math.ceil(window.pageYOffset)>=document.body.offsetHeight&&q()};return window.addEventListener("scroll",e),function(){return window.removeEventListener("scroll",e)}}),[n]),r.createElement(o.Z,{className:"".concat(M.root," review-list")},r.createElement(l.Z,{"aria-label":"simple table",size:"small"},r.createElement(c.Z,{className:M.reviewListTHead},r.createElement(s.Z,null,m.map((function(e){return r.createElement(u.Z,{key:"column-heading-".concat(e),className:"review-".concat(e,"-column")},r.createElement(j,{name:e}))})))),r.createElement(d.Z,null,B&&B.length>0?r.createElement(s.Z,{key:"messages",className:"messages"},r.createElement(u.Z,{colSpan:m.length},r.createElement(y.Z,{messages:B}))):null,n&&n.length?n.map((function(e){return r.createElement(s.Z,{key:"review-".concat(e.id),className:"reviewListRow"},m.map((function(t){return r.createElement(u.Z,{key:"column-".concat(t),className:"review-".concat(t,"-column")},r.createElement(J,{review:e,fieldName:t}))})))})):null),"empty"!==k?r.createElement(v.Z,null,r.createElement(s.Z,{key:"footer",className:"reviewListFooter"},r.createElement(u.Z,{colSpan:m.length},"loading"===k?r.createElement(p.Z,{className:M.loading},r.createElement(h.Z,null)):"noReviews"===k?r.createElement(w.Z,{startAdornment:r.createElement(ne,{value:":raised_hands:"}),text:t(T("noReviews")),align:"center"}):r.createElement(w.Z,{startAdornment:r.createElement(ne,{value:":tada:"}),text:t(T("noMoreReviews")),align:"center"})))):null))},se=ce;ce.propTypes={loading:i().bool,reviews:i().arrayOf(i().oneOfType([i().object])),messages:i().arrayOf(i().oneOfType([i().object])),fields:i().arrayOf(i().string).isRequired,footerMessageKeys:i().objectOf(i().string)},ce.defaultProps={loading:!1,reviews:null,messages:null,footerMessageKeys:{}}}}]);